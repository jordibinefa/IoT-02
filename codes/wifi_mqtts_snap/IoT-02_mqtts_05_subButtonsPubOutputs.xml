<project name="02_subButtonsPubOutputs" app="Snap! 5.4, http://snap.berkeley.edu" version="1"><notes></notes><thumbnail>data:image/png;base64,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</thumbnail><stage name="Stage" width="480" height="360" costume="0" color="255,255,255,1" tempo="60" threadsafe="false" penlog="false" volume="100" pan="0" lines="round" ternary="false" codify="false" inheritance="true" sublistIDs="false" scheduled="false" id="1"><pentrails>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAFoCAYAAACPNyggAAACtUlEQVR4nO3BMQEAAADCoPVPbQwfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+Bo3+AAF/RMkcAAAAAElFTkSuQmCC</pentrails><costumes><list struct="atomic" id="2"></list></costumes><sounds><list struct="atomic" id="3"></list></sounds><variables></variables><blocks></blocks><scripts></scripts><sprites><sprite name="Sprite" idx="1" x="0.19741611673804263" y="0.7015521888653016" heading="90" scale="1" volume="100" pan="0" rotation="1" draggable="true" costume="0" color="80,80,80,1" pen="tip" id="8"><costumes><list struct="atomic" id="9"></list></costumes><sounds><list struct="atomic" id="10"></list></sounds><blocks></blocks><variables></variables><scripts><script x="14" y="11"><block s="receiveGo"></block><block s="doSetVar"><l>broker</l><l>iot.siarq.net:9001</l></block><block s="doSetVar"><l>usr</l><l>upc</l></block><block s="doSetVar"><l>pwd</l><l>school</l></block><block s="doSetVar"><l>topicMacReq</l><l>/macReq</l></block><block s="doSetVar"><l>topicMac</l><l>/mac</l></block><custom-block s="MQTT connect %s %s %s"><block var="broker"/><block var="usr"/><block var="pwd"/></custom-block><block s="doWait"><l>1</l></block><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block var="topicMac"/><block s="reifyScript"><script><block s="doIf"><block s="reportEquals"><block var="topicMac"/><block var="#1"/></block><script><block s="doSetVar"><l>MAC</l><block var="#2"/></block><block s="doSetVar"><l>topicLedW</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledW</l></list></block></block><block s="doSetVar"><l>topicLedR</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledR</l></list></block></block><block s="doSetVar"><l>topicLedY</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledY</l></list></block></block><block s="doSetVar"><l>topicLedG</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledG</l></list></block></block><block s="doSetVar"><l>topicLatchingRelay</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/latchingRelay</l></list></block></block></script></block></script><list><l>#1</l><l>#2</l></list></block></custom-block><block s="doSayFor"><l>Apretad el bot√≥n IO0 antes de preguntar la MAC</l><l>2</l></block></script><script x="44" y="475"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedW"/><l>1</l></custom-block></script><script x="41" y="523"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedW"/><l>0</l></custom-block></script><script x="284" y="475"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLatchingRelay"/><l>1</l></custom-block></script><script x="281" y="521"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLatchingRelay"/><l>0</l></custom-block></script><script x="594" y="522"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedG"/><l>0</l></custom-block></script><script x="589" y="472"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedG"/><l>1</l></custom-block></script><script x="396" y="20"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicMacReq"/><l>reqMac</l></custom-block><block s="doWait"><l>1</l></block><block s="doIf"><block s="reportNot"><block s="reportEquals"><block var="MAC"/><l>0</l></block></block><script><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/#</l></list></block><block s="reifyScript"><script><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/btIO0</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>btIO0: </l><block var="#2"/></list></block><l>0.5</l></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/btI34</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>btI34: </l><block var="#2"/></list></block><l>0.5</l></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/btI35</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>btI35: </l><block var="#2"/></list></block><l>0.5</l></block></script></block></script><list><l>#1</l><l>#2</l></list></block></custom-block></script></block></script><script x="507" y="361"><custom-block s="MQTT unsub %s %s"><block var="broker"/><block var="topicMac"/></custom-block><custom-block s="MQTT disconnect %s"><block var="broker"/></custom-block><block s="doSetVar"><l>MAC</l><l>0</l></block></script></scripts></sprite><watcher var="broker" style="normal" x="4.669704861111768" y="4.669704861111086" color="243,118,29"/><watcher var="usr" style="normal" x="4.669704861111768" y="14.476086003385419" color="243,118,29" hidden="true"/><watcher var="pwd" style="normal" x="4.669704861111768" y="24.28246714565973" color="243,118,29" hidden="true"/><watcher var="topicMacReq" style="normal" x="4.669704861111768" y="34.088848287933985" color="243,118,29" hidden="true"/><watcher var="topicMac" style="normal" x="4.669704861111768" y="43.89522943020833" color="243,118,29" hidden="true"/><watcher var="topicLedW" style="normal" x="4.669704861111768" y="53.70161057248259" color="243,118,29" hidden="true"/><watcher var="topicLedR" style="normal" x="4.669704861111768" y="63.507991714756955" color="243,118,29" hidden="true"/><watcher var="topicLedY" style="normal" x="4.669704861111768" y="73.31437285703119" color="243,118,29" hidden="true"/><watcher var="topicLatchingRelay" style="normal" x="4.669704861111768" y="92.92713514157964" color="243,118,29" hidden="true"/><watcher var="topicLedG" style="normal" x="5.663699687423559" y="70.19882125725078" color="243,118,29" hidden="true"/><watcher var="MAC" style="normal" x="7.739319740854398" y="29.655961436303727" color="243,118,29"/></sprites></stage><hidden></hidden><headers></headers><code></code><blocks><block-definition s="load JS from url: %&apos;url&apos; waiting for object: %&apos;object&apos;" type="command" category="other"><header></header><code></code><translations></translations><inputs><input type="%s"></input><input type="%s"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>url</l><l>object</l></list><l>var nodes = document.getElementsByTagName(&apos;*&apos;),&#xD;    node = nodes[nodes.length - 1].parentNode,&#xD;    script = document.createElement(&apos;script&apos;);&#xD;&#xD;if (object == null) {&#xD;  throw new Error(&#xD;    &apos;You need to specify the name of an object that you expect the library to create.&apos;&#xD;  );&#xD;}&#xD;&#xD;script.id = object.replace(/[^a-z]/gi,&apos;&apos;); &#xD;&#xD;if (!document.getElementById(script.id)) {&#xD;  script.setAttribute(&apos;type&apos;, &apos;text/javascript&apos;);&#xD;  script.setAttribute(&apos;src&apos;, url);&#xD;  node.appendChild(script);&#xD;}</l></block><list><block var="url"/><block var="object"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>objectName</l></list><l>return (typeof window[objectName]) !== &apos;undefined&apos;</l></block><list><block var="object"/></list></block></block></script></block-definition><block-definition s="MQTT connect %&apos;broker&apos; %&apos;username&apos; %&apos;password&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s"></input><input type="%s"></input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>username</l><l>password</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;if (!(&apos;mqtt&apos; in stage)){&#xD;  stage.mqtt = [];&#xD;}&#xD;&#xD;let prefix = window.location.protocol == &apos;https:&apos;?&apos;wss&apos;:&apos;ws&apos;;&#xD;let wsbroker = prefix+&apos;://&apos;+broker;&#xD;&#xD;try{&#xD;  stage.mqtt[broker].end();&#xD;}catch(e){}&#xD;&#xD;delete stage.mqtt[broker];&#xD;&#xD;if (username) {&#xD;console.log(&apos;ei&apos;);&#xD;  stage.mqtt[broker] = mqtt.connect(wsbroker, {&#xD;    username: username,&#xD;    password: password,&#xD;//  reconnectPeriod: -1 &#xD;  });&#xD;}else{&#xD;  stage.mqtt[broker] = mqtt.connect(wsbroker);&#xD;}&#xD;&#xD;stage.mqtt[broker].on(&apos;connect&apos;, function(connack) {&#xD;  console.log(&apos;Connected to &apos;+wsbroker);&#xD;});&#xD;&#xD;stage.mqtt[broker].on(&apos;error&apos;, function(error) {&#xD;  console.log(error.message);&#xD;  try{&#xD;    stage.mqtt[broker].end();&#xD;  }catch(e){}&#xD;  delete stage.mqtt[broker];&#xD;  alert(error.message);&#xD;});&#xD;&#xD;&#xD;&#xD;</l></block><list><block var="broker"/><block var="username"/><block var="password"/></list></block></script></block-definition><block-definition s="MQTT pub %&apos;broker&apos; %&apos;topic&apos; %&apos;msg&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%s">Hello</input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>topic</l><l>msg</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;if (!(&apos;mqtt&apos; in stage)){&#xD;  throw new Error(&apos;No connection to broker &apos; + broker);&#xD;}&#xD;&#xD;if(!stage.mqtt[broker]){&#xD;  throw new Error(&apos;No connection to broker &apos; + broker);&#xD;}&#xD;&#xD;let prefix = window.location.protocol == &apos;https:&apos;?&apos;wss&apos;:&apos;ws&apos;;&#xD;let wsbroker = prefix+&apos;://&apos;+broker;&#xD;&#xD;try{&#xD;  let client = stage.mqtt[broker];&#xD;  client.publish(topic, &apos;&apos; + msg);&#xD;}catch(e){&#xD;//  console.log(e);&#xD;  throw e;&#xD;}&#xD;</l></block><list><block var="broker"/><block var="topic"/><block var="msg"/></list></block></script></block-definition><block-definition s="MQTT sub %&apos;broker&apos; %&apos;topic&apos; %&apos;callback&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%cmdRing"></input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>topic</l><l>callback</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;if (!(&apos;mqtt&apos; in stage)){&#xD;  throw new Error(&apos;No connection to broker &apos;+broker);&#xD;}&#xD;&#xD;let prefix = window.location.protocol == &apos;https:&apos;?&apos;wss&apos;:&apos;ws&apos;;&#xD;let wsbroker = prefix+&apos;://&apos;+broker;&#xD;&#xD;if(stage.mqtt[broker]){&#xD;  try {&#xD;    stage.mqtt[broker].unsubscribe(topic);&#xD;  }catch(e){&#xD;  }&#xD;}else{&#xD;  throw new Error(&apos;No connection to broker &apos;+broker);&#xD;}&#xD;&#xD;stage.mqtt[broker].subscribe(topic);&#xD;&#xD;let mqttListener = function (topic, payload) {	&#xD;  let p = new Process();&#xD;  try {&#xD;    p.initializeFor(callback, new List([topic, payload]));&#xD;  } catch(e) {&#xD;    p.initializeFor(callback, new List([]));&#xD;  }&#xD;  p.onComplete = function(result) {&#xD;  };&#xD;  stage.threads.processes.push(p);&#xD;};&#xD;&#xD;stage.mqtt[broker].on(&apos;message&apos;, mqttListener);&#xD;</l></block><list><block var="broker"/><block var="topic"/><block var="callback"/></list></block></script></block-definition><block-definition s="MQTT unsub %&apos;broker&apos; %&apos;topic&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>topic</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;try{&#xD;  stage.mqtt[broker].unsubscribe(topic);&#xD;}catch(e){&#xD;//  console.log(e);&#xD;}</l></block><list><block var="broker"/><block var="topic"/></list></block></script></block-definition><block-definition s="MQTT disconnect %&apos;broker&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;try{&#xD;  if(broker==&apos;all&apos;){&#xD;    for(let brok of Object.keys(stage.mqtt)){&#xD;      try {&#xD;        stage.mqtt[brok].end();&#xD;      } catch (e0) {&#xD;        console.log(e0);&#xD;      }&#xD;    } &#xD;  }else{&#xD;    stage.mqtt[broker].end();&#xD;  }&#xD;}catch(e1){&#xD;  console.log(e1);&#xD;}&#xD;try{&#xD;  if(broker==&apos;all&apos;){&#xD;    try {&#xD;      delete stage.mqtt;&#xD;      stage.mqtt=[];&#xD;    } catch (e2) {&#xD;      console.log(e2);&#xD;    }&#xD;  }else{&#xD;    delete stage.mqtt[broker];&#xD;  }&#xD;}catch(e3){&#xD;//  console.log(e3);&#xD;}&#xD;</l></block><list><block var="broker"/></list></block></script></block-definition><block-definition s="MQTT request %&apos;broker&apos; %&apos;topic&apos; %&apos;idCall&apos; %&apos;msg&apos; %&apos;callback&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%s">idCall</input><input type="%s">Hello</input><input type="%cmdRing"></input></inputs><script><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block><block s="reifyScript"><script><block s="doRun"><block var="callback"/><list><block var="#2"/><block var="#1"/></list></block><custom-block s="MQTT unsub %s %s"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></custom-block></script><list><l>#1</l><l>#2</l></list></block></custom-block><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block s="reportJoinWords"><list><block var="topic"/><l>/</l><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></list></block><block var="msg"/></custom-block></script></block-definition><block-definition s="MQTT response %&apos;broker&apos; %&apos;topic&apos; %&apos;reply&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName/#</input><input type="%repRing"></input></inputs><script><block s="doDeclareVariables"><list><l>resp</l><l>callbackTopic</l></list></block><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block var="topic"/><block s="reifyScript"><script><block s="doSetVar"><l>resp</l><block s="evaluate"><block var="reply"/><list><block var="#1"/><block var="#2"/></list></block></block><block s="doSetVar"><l>callbackTopic</l><block s="reportListItem"><l><option>last</option></l><block s="reportTextSplit"><block var="#1"/><l>/</l></block></block></block><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="callbackTopic"/><block var="resp"/></custom-block></script><list><l>#1</l><l>#2</l></list></block></custom-block></script></block-definition><block-definition s="example MQTT response reporter %&apos;topic&apos; %&apos;msg&apos;" type="reporter" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">topicName</input><input type="%s">msg</input></inputs><script><block s="doThinkFor"><block s="reportJoinWords"><list><l>hello </l><block var="msg"/></list></block><l>1</l></block><block s="doReport"><block var="msg"/></block></script></block-definition><block-definition s="MQTT request %&apos;broker&apos; %&apos;topic&apos; %&apos;idCall&apos; %&apos;msg&apos;" type="reporter" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%s">idCall</input><input type="%s">Hello</input></inputs><script><block s="doDeclareVariables"><list><l>resp</l><l>semaphor</l></list></block><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block><block s="reifyScript"><script><block s="doSetVar"><l>resp</l><block var="#2"/></block><custom-block s="MQTT unsub %s %s"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></custom-block><block s="doSetVar"><l>semaphor</l><block s="reportBoolean"><l><bool>true</bool></l></block></block></script><list><l>#1</l><l>#2</l></list></block></custom-block><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block s="reportJoinWords"><list><block var="topic"/><l>/</l><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></list></block><block var="msg"/></custom-block><block s="doWaitUntil"><block var="semaphor"/></block><block s="doReport"><block var="resp"/></block></script></block-definition><block-definition s="load MQTT library" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><custom-block s="load JS from url: %s waiting for object: %s"><l>https://unpkg.com/mqtt/dist/mqtt.min.js</l><l>mqtt</l></custom-block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list></list><l>return (typeof mqtt.connect) !== &apos;undefined&apos;</l></block><list></list></block></block></script></block-definition></blocks><variables><variable name="broker"><l>iot.siarq.net:9001</l></variable><variable name="usr"><l>upc</l></variable><variable name="pwd"><l>school</l></variable><variable name="topicMacReq"><l>/macReq</l></variable><variable name="topicMac"><l>/mac</l></variable><variable name="MAC"></variable><variable name="topicLedW"><l>/246F28AA380C/ledW</l></variable><variable name="topicLedR"><l>/246F28AA380C/ledR</l></variable><variable name="topicLedY"><l>/246F28AA380C/ledY</l></variable><variable name="topicLedG"><l>/246F28AA380C/ledG</l></variable><variable name="topicLatchingRelay"><l>/246F28AA380C/latchingRelay</l></variable></variables></project>