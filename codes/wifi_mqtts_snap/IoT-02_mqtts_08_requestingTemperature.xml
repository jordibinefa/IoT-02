<project name="05_requestingTemperature" app="Snap! 5.4, http://snap.berkeley.edu" version="1"><notes></notes><thumbnail>data:image/png;base64,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</thumbnail><stage name="Stage" width="480" height="360" costume="0" color="255,255,255,1" tempo="60" threadsafe="false" penlog="false" volume="100" pan="0" lines="round" ternary="false" codify="false" inheritance="true" sublistIDs="false" scheduled="false" id="1"><pentrails>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAFoCAYAAACPNyggAAACtUlEQVR4nO3BMQEAAADCoPVPbQwfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+Bo3+AAF/RMkcAAAAAElFTkSuQmCC</pentrails><costumes><list struct="atomic" id="2"></list></costumes><sounds><list struct="atomic" id="3"></list></sounds><variables></variables><blocks></blocks><scripts></scripts><sprites><sprite name="Sprite" idx="1" x="0.5974161167385319" y="-0.4984478111346107" heading="90" scale="1" volume="100" pan="0" rotation="1" draggable="true" costume="0" color="80,80,80,1" pen="tip" id="8"><costumes><list struct="atomic" id="9"></list></costumes><sounds><list struct="atomic" id="10"></list></sounds><blocks></blocks><variables></variables><scripts><script x="14" y="16"><block s="receiveGo"></block><block s="doSetVar"><l>broker</l><l>iot.siarq.net:9001</l></block><block s="doSetVar"><l>usr</l><l>upc</l></block><block s="doSetVar"><l>pwd</l><l>school</l></block><block s="doSetVar"><l>topicMacReq</l><l>/macReq</l></block><block s="doSetVar"><l>topicMac</l><l>/mac</l></block><custom-block s="MQTT connect %s %s %s"><block var="broker"/><block var="usr"/><block var="pwd"/></custom-block><block s="doWait"><l>1</l></block><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block var="topicMac"/><block s="reifyScript"><script><block s="doIf"><block s="reportEquals"><block var="topicMac"/><block var="#1"/></block><script><block s="doSetVar"><l>MAC</l><block var="#2"/></block><block s="doSetVar"><l>topicLedW</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledW</l></list></block></block><block s="doSetVar"><l>topicLedR</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledR</l></list></block></block><block s="doSetVar"><l>topicLedY</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledY</l></list></block></block><block s="doSetVar"><l>topicLedG</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ledG</l></list></block></block><block s="doSetVar"><l>topicLatchingRelay</l><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/latchingRelay</l></list></block></block></script></block></script><list><l>#1</l><l>#2</l></list></block></custom-block><block s="doSayFor"><l>Apretad el botón IO0 antes de preguntar la MAC</l><l>2</l></block></script><script x="213" y="48"><custom-block s="MQTT unsub %s %s"><block var="broker"/><block var="topicMac"/></custom-block><custom-block s="MQTT disconnect %s"><block var="broker"/></custom-block><block s="doSetVar"><l>MAC</l><l>0</l></block></script><script x="435" y="10"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicMacReq"/><l>reqMac</l></custom-block><block s="doWait"><l>1</l></block><block s="doIf"><block s="reportNot"><block s="reportEquals"><block var="MAC"/><l>0</l></block></block><script><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/#</l></list></block><block s="reifyScript"><script><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/btIO0</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>btIO0: </l><block var="#2"/></list></block><l>0.5</l></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/btI34</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>btI34: </l><block var="#2"/></list></block><l>0.5</l></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/btI35</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>btI35: </l><block var="#2"/></list></block><l>0.5</l></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/latchingRelayState</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>Relay State: </l><block var="#2"/></list></block><l>0.5</l></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ldr</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>LDR: </l><block var="#2"/></list></block><l>0.5</l></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/temp</l></list></block><block var="#1"/></block><script><block s="doSayFor"><block s="reportJoinWords"><list><l>T: </l><block var="#2"/><l>ºC</l></list></block><l>0.5</l></block></script></block></script><list><l>#1</l><l>#2</l></list></block></custom-block></script></block></script><script x="281" y="645"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLatchingRelay"/><l>0</l></custom-block></script><script x="585" y="643"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedG"/><l>0</l></custom-block></script><script x="38" y="644"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedW"/><l>0</l></custom-block></script><script x="40" y="597"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedW"/><l>1</l></custom-block></script><script x="279" y="597"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLatchingRelay"/><l>1</l></custom-block></script><script x="581" y="593"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="topicLedG"/><l>1</l></custom-block></script><script x="41" y="542"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/latchingRelayStateReq</l></list></block><l>reqLRstate</l></custom-block></script><script x="490" y="540"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/ldrReq</l></list></block><l>reqLDR</l></custom-block></script><script x="41" y="489"><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block s="reportJoinWords"><list><l>/</l><block var="MAC"/><l>/tempReq</l></list></block><l>reqTemp</l></custom-block></script></scripts></sprite><watcher var="broker" style="normal" x="2.918565538194798" y="2.9185655381944287" color="243,118,29"/><watcher var="usr" style="normal" x="2.918565538194798" y="9.047553752115896" color="243,118,29" hidden="true"/><watcher var="pwd" style="normal" x="2.918565538194798" y="15.176541966037334" color="243,118,29" hidden="true"/><watcher var="topicMacReq" style="normal" x="2.918565538194798" y="21.305530179958737" color="243,118,29" hidden="true"/><watcher var="topicMac" style="normal" x="2.918565538194798" y="27.434518393880225" color="243,118,29" hidden="true"/><watcher var="topicLedW" style="normal" x="2.918565538194798" y="33.563506607801656" color="243,118,29" hidden="true"/><watcher var="topicLedR" style="normal" x="2.918565538194798" y="39.6924948217231" color="243,118,29" hidden="true"/><watcher var="topicLedY" style="normal" x="2.918565538194798" y="45.82148303564446" color="243,118,29" hidden="true"/><watcher var="topicLatchingRelay" style="normal" x="2.918565538194798" y="58.0794594634873" color="243,118,29" hidden="true"/><watcher var="topicLedG" style="normal" x="3.539812304639554" y="43.874263285781765" color="243,118,29" hidden="true"/><watcher var="topicLRstate" style="normal" x="6.249999999999773" y="6.25" color="243,118,29" hidden="true"/><watcher var="MAC" style="normal" x="5.837074838034141" y="31.53497589768986" color="243,118,29"/></sprites></stage><hidden></hidden><headers></headers><code></code><blocks><block-definition s="load JS from url: %&apos;url&apos; waiting for object: %&apos;object&apos;" type="command" category="other"><header></header><code></code><translations></translations><inputs><input type="%s"></input><input type="%s"></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>url</l><l>object</l></list><l>var nodes = document.getElementsByTagName(&apos;*&apos;),&#xD;    node = nodes[nodes.length - 1].parentNode,&#xD;    script = document.createElement(&apos;script&apos;);&#xD;&#xD;if (object == null) {&#xD;  throw new Error(&#xD;    &apos;You need to specify the name of an object that you expect the library to create.&apos;&#xD;  );&#xD;}&#xD;&#xD;script.id = object.replace(/[^a-z]/gi,&apos;&apos;); &#xD;&#xD;if (!document.getElementById(script.id)) {&#xD;  script.setAttribute(&apos;type&apos;, &apos;text/javascript&apos;);&#xD;  script.setAttribute(&apos;src&apos;, url);&#xD;  node.appendChild(script);&#xD;}</l></block><list><block var="url"/><block var="object"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>objectName</l></list><l>return (typeof window[objectName]) !== &apos;undefined&apos;</l></block><list><block var="object"/></list></block></block></script></block-definition><block-definition s="MQTT connect %&apos;broker&apos; %&apos;username&apos; %&apos;password&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s"></input><input type="%s"></input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>username</l><l>password</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;if (!(&apos;mqtt&apos; in stage)){&#xD;  stage.mqtt = [];&#xD;}&#xD;&#xD;let prefix = window.location.protocol == &apos;https:&apos;?&apos;wss&apos;:&apos;ws&apos;;&#xD;let wsbroker = prefix+&apos;://&apos;+broker;&#xD;&#xD;try{&#xD;  stage.mqtt[broker].end();&#xD;}catch(e){}&#xD;&#xD;delete stage.mqtt[broker];&#xD;&#xD;if (username) {&#xD;console.log(&apos;ei&apos;);&#xD;  stage.mqtt[broker] = mqtt.connect(wsbroker, {&#xD;    username: username,&#xD;    password: password,&#xD;//  reconnectPeriod: -1 &#xD;  });&#xD;}else{&#xD;  stage.mqtt[broker] = mqtt.connect(wsbroker);&#xD;}&#xD;&#xD;stage.mqtt[broker].on(&apos;connect&apos;, function(connack) {&#xD;  console.log(&apos;Connected to &apos;+wsbroker);&#xD;});&#xD;&#xD;stage.mqtt[broker].on(&apos;error&apos;, function(error) {&#xD;  console.log(error.message);&#xD;  try{&#xD;    stage.mqtt[broker].end();&#xD;  }catch(e){}&#xD;  delete stage.mqtt[broker];&#xD;  alert(error.message);&#xD;});&#xD;&#xD;&#xD;&#xD;</l></block><list><block var="broker"/><block var="username"/><block var="password"/></list></block></script></block-definition><block-definition s="MQTT pub %&apos;broker&apos; %&apos;topic&apos; %&apos;msg&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%s">Hello</input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>topic</l><l>msg</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;if (!(&apos;mqtt&apos; in stage)){&#xD;  throw new Error(&apos;No connection to broker &apos; + broker);&#xD;}&#xD;&#xD;if(!stage.mqtt[broker]){&#xD;  throw new Error(&apos;No connection to broker &apos; + broker);&#xD;}&#xD;&#xD;let prefix = window.location.protocol == &apos;https:&apos;?&apos;wss&apos;:&apos;ws&apos;;&#xD;let wsbroker = prefix+&apos;://&apos;+broker;&#xD;&#xD;try{&#xD;  let client = stage.mqtt[broker];&#xD;  client.publish(topic, &apos;&apos; + msg);&#xD;}catch(e){&#xD;//  console.log(e);&#xD;  throw e;&#xD;}&#xD;</l></block><list><block var="broker"/><block var="topic"/><block var="msg"/></list></block></script></block-definition><block-definition s="MQTT sub %&apos;broker&apos; %&apos;topic&apos; %&apos;callback&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%cmdRing"></input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>topic</l><l>callback</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;if (!(&apos;mqtt&apos; in stage)){&#xD;  throw new Error(&apos;No connection to broker &apos;+broker);&#xD;}&#xD;&#xD;let prefix = window.location.protocol == &apos;https:&apos;?&apos;wss&apos;:&apos;ws&apos;;&#xD;let wsbroker = prefix+&apos;://&apos;+broker;&#xD;&#xD;if(stage.mqtt[broker]){&#xD;  try {&#xD;    stage.mqtt[broker].unsubscribe(topic);&#xD;  }catch(e){&#xD;  }&#xD;}else{&#xD;  throw new Error(&apos;No connection to broker &apos;+broker);&#xD;}&#xD;&#xD;stage.mqtt[broker].subscribe(topic);&#xD;&#xD;let mqttListener = function (topic, payload) {	&#xD;  let p = new Process();&#xD;  try {&#xD;    p.initializeFor(callback, new List([topic, payload]));&#xD;  } catch(e) {&#xD;    p.initializeFor(callback, new List([]));&#xD;  }&#xD;  p.onComplete = function(result) {&#xD;  };&#xD;  stage.threads.processes.push(p);&#xD;};&#xD;&#xD;stage.mqtt[broker].on(&apos;message&apos;, mqttListener);&#xD;</l></block><list><block var="broker"/><block var="topic"/><block var="callback"/></list></block></script></block-definition><block-definition s="MQTT unsub %&apos;broker&apos; %&apos;topic&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l><l>topic</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;try{&#xD;  stage.mqtt[broker].unsubscribe(topic);&#xD;}catch(e){&#xD;//  console.log(e);&#xD;}</l></block><list><block var="broker"/><block var="topic"/></list></block></script></block-definition><block-definition s="MQTT disconnect %&apos;broker&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input></inputs><script><custom-block s="load MQTT library"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>broker</l></list><l>/* Xavier Pi - 2020 (xpi@enginyers.net)  */&#xD;&#xD;let stage =  this.parentThatIsA(StageMorph);&#xD;&#xD;try{&#xD;  if(broker==&apos;all&apos;){&#xD;    for(let brok of Object.keys(stage.mqtt)){&#xD;      try {&#xD;        stage.mqtt[brok].end();&#xD;      } catch (e0) {&#xD;        console.log(e0);&#xD;      }&#xD;    } &#xD;  }else{&#xD;    stage.mqtt[broker].end();&#xD;  }&#xD;}catch(e1){&#xD;  console.log(e1);&#xD;}&#xD;try{&#xD;  if(broker==&apos;all&apos;){&#xD;    try {&#xD;      delete stage.mqtt;&#xD;      stage.mqtt=[];&#xD;    } catch (e2) {&#xD;      console.log(e2);&#xD;    }&#xD;  }else{&#xD;    delete stage.mqtt[broker];&#xD;  }&#xD;}catch(e3){&#xD;//  console.log(e3);&#xD;}&#xD;</l></block><list><block var="broker"/></list></block></script></block-definition><block-definition s="MQTT request %&apos;broker&apos; %&apos;topic&apos; %&apos;idCall&apos; %&apos;msg&apos; %&apos;callback&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%s">idCall</input><input type="%s">Hello</input><input type="%cmdRing"></input></inputs><script><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block><block s="reifyScript"><script><block s="doRun"><block var="callback"/><list><block var="#2"/><block var="#1"/></list></block><custom-block s="MQTT unsub %s %s"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></custom-block></script><list><l>#1</l><l>#2</l></list></block></custom-block><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block s="reportJoinWords"><list><block var="topic"/><l>/</l><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></list></block><block var="msg"/></custom-block></script></block-definition><block-definition s="MQTT response %&apos;broker&apos; %&apos;topic&apos; %&apos;reply&apos;" type="command" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName/#</input><input type="%repRing"></input></inputs><script><block s="doDeclareVariables"><list><l>resp</l><l>callbackTopic</l></list></block><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block var="topic"/><block s="reifyScript"><script><block s="doSetVar"><l>resp</l><block s="evaluate"><block var="reply"/><list><block var="#1"/><block var="#2"/></list></block></block><block s="doSetVar"><l>callbackTopic</l><block s="reportListItem"><l><option>last</option></l><block s="reportTextSplit"><block var="#1"/><l>/</l></block></block></block><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block var="callbackTopic"/><block var="resp"/></custom-block></script><list><l>#1</l><l>#2</l></list></block></custom-block></script></block-definition><block-definition s="example MQTT response reporter %&apos;topic&apos; %&apos;msg&apos;" type="reporter" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">topicName</input><input type="%s">msg</input></inputs><script><block s="doThinkFor"><block s="reportJoinWords"><list><l>hello </l><block var="msg"/></list></block><l>1</l></block><block s="doReport"><block var="msg"/></block></script></block-definition><block-definition s="MQTT request %&apos;broker&apos; %&apos;topic&apos; %&apos;idCall&apos; %&apos;msg&apos;" type="reporter" category="sensing"><header></header><code></code><translations></translations><inputs><input type="%s">test.mosquitto.org:8081</input><input type="%s">topicName</input><input type="%s">idCall</input><input type="%s">Hello</input></inputs><script><block s="doDeclareVariables"><list><l>resp</l><l>semaphor</l></list></block><custom-block s="MQTT sub %s %s %cmdRing"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block><block s="reifyScript"><script><block s="doSetVar"><l>resp</l><block var="#2"/></block><custom-block s="MQTT unsub %s %s"><block var="broker"/><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></custom-block><block s="doSetVar"><l>semaphor</l><block s="reportBoolean"><l><bool>true</bool></l></block></block></script><list><l>#1</l><l>#2</l></list></block></custom-block><custom-block s="MQTT pub %s %s %s"><block var="broker"/><block s="reportJoinWords"><list><block var="topic"/><l>/</l><block s="reportJoinWords"><list><l>idCall</l><block var="idCall"/></list></block></list></block><block var="msg"/></custom-block><block s="doWaitUntil"><block var="semaphor"/></block><block s="doReport"><block var="resp"/></block></script></block-definition><block-definition s="load MQTT library" type="command" category="other"><header></header><code></code><translations></translations><inputs></inputs><script><custom-block s="load JS from url: %s waiting for object: %s"><l>https://unpkg.com/mqtt/dist/mqtt.min.js</l><l>mqtt</l></custom-block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list></list><l>return (typeof mqtt.connect) !== &apos;undefined&apos;</l></block><list></list></block></block></script></block-definition></blocks><variables><variable name="broker"><l>iot.siarq.net:9001</l></variable><variable name="usr"><l>upc</l></variable><variable name="pwd"><l>school</l></variable><variable name="topicMacReq"><l>/macReq</l></variable><variable name="topicMac"><l>/mac</l></variable><variable name="MAC"></variable><variable name="topicLedW"><l>/246F28AA380C/ledW</l></variable><variable name="topicLedR"><l>/246F28AA380C/ledR</l></variable><variable name="topicLedY"><l>/246F28AA380C/ledY</l></variable><variable name="topicLedG"><l>/246F28AA380C/ledG</l></variable><variable name="topicLatchingRelay"><l>/246F28AA380C/latchingRelay</l></variable><variable name="topicLRstate"><l>/246F28AA380C/latchingRelayState</l></variable></variables></project>